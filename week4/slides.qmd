---
title: ETC3550/ETC5550 Applied forecasting
author: "Week 4: The Forecasters' toolbox"
format:
  beamer:
    aspectratio: 169
    fontsize: 14pt
    section-titles: false
    knitr:
      opts_chunk:
        dev: "cairo_pdf"
    pdf-engine: pdflatex
    fig-width: 7.5
    fig-height: 3.5
    include-in-header: ../header.tex
---

```{r setup, include=FALSE}
source(here::here("setup.R"))
```
```{r tscvplots, echo=FALSE}
tscv_plot <- function(.init, .step, h = 1) {
  expand.grid(
    time = seq(26),
    .id = seq(trunc(11 / .step))
  ) |>
    group_by(.id) |>
    mutate(
      observation = case_when(
        time <= ((.id - 1) * .step + .init) ~ "train",
        time %in% c((.id - 1) * .step + .init + h) ~ "test",
        TRUE ~ "unused"
      )
    ) |>
    ungroup() |>
    filter(.id <= 26 - .init) |>
    ggplot(aes(x = time, y = .id)) +
    geom_segment(
      aes(x = 0, xend = 27, y = .id, yend = .id),
      arrow = arrow(length = unit(0.015, "npc")),
      col = "black", size = .25
    ) +
    geom_point(aes(col = observation), size = 2) +
    scale_y_reverse() +
    scale_color_manual(values = c(train = "#0072B2", test = "#D55E00", unused = "gray")) +
    # theme_void() +
    # geom_label(aes(x = 28.5, y = 1, label = "time")) +
    guides(col = FALSE) +
    labs(x = "time", y = "") +
    theme_void() +
    theme(axis.title = element_text())
}
```

## Time series cross-validation {-}

**Traditional evaluation**

```{r traintest1, fig.height=1, echo=FALSE}
tscv_plot(.init = 18, .step = 10, h = 1:8) +
  geom_text(aes(x = 10, y = 0.8, label = "Training data"), color = "#0072B2") +
  geom_text(aes(x = 21, y = 0.8, label = "Test data"), color = "#D55E00") +
  ylim(1, 0)
```

\pause

**Time series cross-validation**

```{r tscvggplot1, echo=FALSE, fig.height=2.2}
tscv_plot(.init = 8, .step = 1, h = 1) +
  geom_text(aes(x = 21, y = 0, label = "h = 1"), color = "#D55E00")
```

## Time series cross-validation {-}

**Traditional evaluation**

```{r traintest2, ref.label="traintest1", fig.height=1, echo=FALSE}
```

**Time series cross-validation**

```{r tscvggplot2, echo=FALSE,  fig.height=2.2}
tscv_plot(.init = 8, .step = 1, h = 2) +
  geom_text(aes(x = 21, y = 0, label = "h = 2"), color = "#D55E00")
```

## Time series cross-validation {-}

**Traditional evaluation**

```{r traintest3, ref.label="traintest1", fig.height=1, echo=FALSE}
```

**Time series cross-validation**

```{r tscvggplot3, echo=FALSE,  fig.height=2.2}
tscv_plot(.init = 8, .step = 1, h = 3) +
  geom_text(aes(x = 21, y = 0, label = "h = 3"), color = "#D55E00")
```

## Time series cross-validation {-}

**Traditional evaluation**

```{r traintest4, ref.label="traintest1", fig.height=1, echo=FALSE}
```

**Time series cross-validation**

```{r tscvggplot4, echo=FALSE, fig.height=2.2}
tscv_plot(.init = 8, .step = 1, h = 4) +
  geom_text(aes(x = 21, y = 0, label = "h = 4"), color = "#D55E00")
```

\only<2>{\begin{textblock}{8}(.5,6.4)\begin{block}{}\fontsize{12}{13}\sf
\begin{itemize}\tightlist
\item Forecast accuracy averaged over test sets.
\item Also known as "evaluation on a rolling forecasting origin"
\end{itemize}\end{block}\end{textblock}}

\vspace*{10cm}


## Your turn
\fontsize{13}{14}\sf

```{r}
#| child: activities.md
```
